generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Restaurant {
  id             String         @id @default(uuid())
  name           String
  currency       String         @default("USD")
  abaMerchantId  String?
  abaApiKey      String?
  categories     Category[]
  items          MenuItem[]
  orders         Order[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model Category {
  id           String      @id @default(uuid())
  nameEn       String
  nameKm       String
  restaurantId String
  restaurant   Restaurant  @relation(fields: [restaurantId], references: [id])
  items        MenuItem[]
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model MenuItem {
  id           String      @id @default(uuid())
  nameEn       String
  nameKm       String
  price        Float
  imageUrl     String?
  available    Boolean     @default(true)
  stockCount   Int?
  categoryId   String
  category     Category    @relation(fields: [categoryId], references: [id])
  restaurantId String
  restaurant   Restaurant  @relation(fields: [restaurantId], references: [id])
  orderItems   OrderItem[]
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Order {
  id              String       @id @default(uuid())
  orderNumber     String       @unique
  roomId          String       @default("Walk-in")
  totalUsd        Float
  paymentMethod   PaymentType
  status          OrderStatus  @default(PENDING_PAYMENT)
  guestName       String?
  specialRequests String?
  restaurantId    String
  restaurant      Restaurant   @relation(fields: [restaurantId], references: [id])
  items           OrderItem[]
  isPostedToFolio Boolean      @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model OrderItem {
  id         String   @id @default(uuid())
  orderId    String
  order      Order    @relation(fields: [orderId], references: [id])
  menuItemId String
  menuItem   MenuItem @relation(fields: [menuItemId], references: [id])
  quantity   Int
  priceAtTime Float
}

enum PaymentType {
  CASH
  KHQR
}

enum OrderStatus {
  PENDING_PAYMENT
  PENDING_KITCHEN
  PREPARING
  READY
  DELIVERED
  CANCELLED
}
